<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.xsd">

    <changeSet id="apikey-testdata" author="ricardas">
        <comment>Add default apiKey which can be used for scenarios which do not case about permissions.
            This maps to header value X-ROAD-APIKEY TOKEN=d56e1ca7-4134-4ed4-8030-5f330bdb602a
        </comment>
        <sql>
            -- noinspection SqlResolve
            INSERT INTO apikey
                (id, encodedkey)
            VALUES (1, 'ad26a8235b3e847dc0b9ac34733d5acb39e2b6af634796e7eebe171165cdf2d1');

            INSERT INTO apikey_roles
                (id, apikey_id, role)
            VALUES (1000001, 1, 'XROAD_SYSTEM_ADMINISTRATOR'),
                   (1000002, 1, 'XROAD_SECURITY_OFFICER'),
                   (1000003, 1, 'XROAD_REGISTRATION_OFFICER'),
                   (1000004, 1, 'XROAD_MANAGEMENT_SERVICE');
            ALTER SEQUENCE apikey_roles_id_seq RESTART WITH 1001000;

        </sql>
    </changeSet>

    <changeSet id="internal-configuration-testdata" author="vpaliliunas">
        <comment>Test data for configuration info apis testing
        </comment>
        <sql>
            <![CDATA[
            -- noinspection SqlResolve
            INSERT INTO system_parameters
                (key, value, created_at, updated_at, ha_node_name)
            VALUES ('centralServerAddress', 'cs', '2022-01-01 01:00:00.000000', '2022-01-02 01:00:00.000000', 'node_0');

            INSERT INTO configuration_sources
            (source_type, active_key_id, anchor_file, anchor_file_hash, anchor_generated_at, ha_node_name)
            VALUES ('internal', null, null,
                    '4D:72:A8:60:90:88:A2:5B:9C:6B:91:86:3C:D7:44:CE:9E:E1:1C:27:8E:33:F4:E5:31:68:F2:EC',
                    '2022-01-01 01:00:00.000000', 'node_0');

            INSERT INTO configuration_sources
            (source_type, active_key_id, anchor_file, anchor_file_hash, anchor_generated_at, ha_node_name)
            VALUES ('external', null, null,
                    '4D:72:A8:60:90:88:A2:5B:9C:6B:91:86:3C:D7:44:CE:9E:E1:1C:27:8E:33:F4:E5:31:68:F2:EC',
                    '2022-01-01 01:00:00.000000', 'node_0');

            INSERT INTO distributed_files
            (version, file_name, file_data, content_identifier, file_updated_at, ha_node_name)
            VALUES (2, 'file.xml', '<conf/>', 'SHARED-ID', '2022-01-01 01:00:00.000000', 'node_0');
            ]]>
        </sql>
    </changeSet>

    <changeSet id="security-server-owners-global-group" author="justass">
        <comment>Create security-server-owners global group.</comment>
        <sql>
            INSERT INTO global_groups(group_code, description, created_at, updated_at)
            VALUES ('security-server-owners','Security server owners', now(), now());
        </sql>
    </changeSet>
    <changeSet id="security-server-identifier" author="ovidijus">
        <comment>Add instance identifier to system parameters.</comment>
        <sql>
            INSERT INTO system_parameters
                (key, value, created_at, updated_at, ha_node_name)
            VALUES ('instanceIdentifier', 'CS', '2022-01-01 01:00:00.000000', '2022-01-02 01:00:00.000000', 'node_0');
        </sql>
    </changeSet>
    <changeSet id="add-configuration-signing-keys" author="ovidijus">
        <comment>Add signing keys for configuration sources.</comment>
        <sql>
            INSERT INTO configuration_signing_keys
                (configuration_source_id, key_identifier, cert, key_generated_at, token_identifier)
            VALUES (
                    (SELECT id FROM configuration_sources WHERE source_type = 'internal'),
                    'F397AF7369B15D42D7190E90ECA9508D48275FAB',
                    E'\\x308202A930820191A003020102020101300D06092A864886F70D01010D0500300E310C300A06035504030C034E2F41301E170D3730303130313030303030305A170D3338303130313030303030305A300E310C300A06035504030C034E2F4130820122300D06092A864886F70D01010105000382010F003082010A0282010100A7C38DAFF82C0F36623B8F6E02D141EC35F8710CA6B8AE4A60AA4E222A74390B2CD2C6F7A875B76E033FA1DA51CE1D3A489CE82D89877C0944C953F03D5342564FC580E323967802F182B46502647DE386F04C329E187BC99E253B791F613F498A757C4F52D64E3F41117BA9EA1C8586FDFD8D017D92C7A7605AFA3D3419D767FDE541A81A5079389B3B557E4E2337913306A920AF7FF6A17917FCEFCCDE15363AA36841294735BB93124A309115A453B50629B904B92FA57666D85AF4C279A42C2678CDF8ABC3CAA4C57B1E945E4AFAF65EE4303B8D958C6BB047D773EE58CBA4997A095622088AF9C82B6BD13B4DFE84266650C0790C6B4D314FEE28024EFF0203010001A3123010300E0603551D0F0101FF040403020640300D06092A864886F70D01010D0500038201010031437AE665AA7FCFCFC8872A62AE8E304D033407919F7D08EFF89C2E1BAE98610771D612B33784F3D02D462F8A105BB594A8F8AC09FA1DAFBAD093FFDDB20CB6AF34EEBD55E914F0EB66472104DB076857A904C8B5B58872736A52ED1155EAAD13428B933D4AFECCBEF94A5869B925FAC5909B843BAED22B19C1A8308F7DEE4DA1675BF271F1CFFC127ACEFD61062E386A5F2FC10F9BEB7C4C7095C62D4654AF470C3C1230C2774450DD67A1E7AD6FE244328051620B0370EA57CC075939B2D4A13F9213052CF61F591F4D56D15BF3F57D506861307B5F8B9BB1C9C4638E0E30BEA0F4926D0DB2C7E57738CAB7D598E2F46793230EA5E624FEC2FCA48D38B25C',
                    '2022-01-02 01:00:00.000000',
                    '0');

            INSERT INTO configuration_signing_keys
            (configuration_source_id, key_identifier, cert, key_generated_at, token_identifier)
            VALUES (
                           (SELECT id FROM configuration_sources WHERE source_type = 'external'),
                           'BAE59C0FA417D2CD65FAB7DB5E493D0D6053B777',
                           E'\\x308202A930820191A003020102020101300D06092A864886F70D01010D0500300E310C300A06035504030C034E2F41301E170D3730303130313030303030305A170D3338303130313030303030305A300E310C300A06035504030C034E2F4130820122300D06092A864886F70D01010105000382010F003082010A02820101008150D8FDCEE181658822435AB88F178FCBB0A97BC6DBAF7EFEC929E39102A5F03D06FFABC8ACF64FAB3D91464D5068A995D7090595C0A4B32BBED1054F9E99A3458E809645914427224F6D63087A4279FF64C234FEF8DC14015F2027EB2822A6AC594099A493C40E4095AC1FBF8CEDB65A5B5DCE9AA68F7C97D8DD734481BA75DAA83887B3E56D1CDACB72EF0D6C1E70BE69D1680485AC65CB4D1DF2E5227284912B536BBF174EB2BC1278D1F2ACE96556238745B1399BCDEE8A8D64375481E1B7801DBD4CBA63DA8E07FEB4DB5258094F48014BF00723133344F51B31569E0CD19AA7A39F8DEFFC25CD6D6CE74BE708D873DA586D4E69C33FE8486308EAD6810203010001A3123010300E0603551D0F0101FF040403020640300D06092A864886F70D01010D0500038201010051533EC2801113090A158D6E11954E487372D52973AC4243DE03E6FEE8BE63DDCBBC6AC24ABC1525552A7777646FD22C1C3E897AFFD25E3105FE9846555CB45874BC11726990B19D57F95197F4E7859BD0EA4EEAE5A994778DDBC481DBDC9A67E33DDFA56817D3BFE8A7748E592052295383E26AE1210424C0940A4D29231435EB2448A361CC93FAB81451E39688D4A76E2EE71A7060265200E5F7F5A2399BF64062154352DED1D81B485E1245F8EABB3A025F60AA366D6A20CAE97919C2592AC7BEBD2F3C5196796B50BCD0A56D52C04C8441D57364FFE4A92B2A7F230D99EA243B5864F85B45BE8462DD71B5B846093BE33CA0FBE8F7DF86CAEE39210AE68A',
                           '2022-01-02 01:00:00.000000',
                           '0');
            UPDATE configuration_sources SET active_key_id = (SELECT id FROM configuration_signing_keys where key_identifier = 'F397AF7369B15D42D7190E90ECA9508D48275FAB') WHERE source_type = 'internal';
            UPDATE configuration_sources SET active_key_id = (SELECT id FROM configuration_signing_keys where key_identifier = 'BAE59C0FA417D2CD65FAB7DB5E493D0D6053B777') WHERE source_type = 'external';

            UPDATE configuration_sources SET active_key_id = (SELECT id FROM configuration_signing_keys where key_identifier = 'F397AF7369B15D42D7190E90ECA9508D48275FAB') WHERE source_type = 'internal';
            UPDATE configuration_sources SET active_key_id = (SELECT id FROM configuration_signing_keys where key_identifier = 'BAE59C0FA417D2CD65FAB7DB5E493D0D6053B777') WHERE source_type = 'external';
        </sql>
    </changeSet>
</databaseChangeLog>
